<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .mainSec {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        max-width: 800px;
        width: 100%;
        padding: 40px;
      }

      h1 {
        text-align: center;
        color: #667eea;
        margin-bottom: 30px;
      }

      #statusArea {
        margin-bottom: 15px;
        min-height: 30px;
      }

      .status {
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
      }

      .status.info { background: #e3f2fd; color: #1976d2; border-left: 4px solid #1976d2; }
      .status.success { background: #e8f5e9; color: #388e3c; border-left: 4px solid #388e3c; }
      .status.error { background: #ffebee; color: #c62828; border-left: 4px solid #c62828; }
      .status.loading { background: #fff3e0; color: #f57c00; border-left: 4px solid #f57c00; }

      .display {
        background: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 12px;
        padding: 30px;
        min-height: 300px;
        max-height: 400px;
        overflow-y: auto;
        margin-bottom: 25px;
        font-size: 14px;
        line-height: 1.6;
      }

      .inputControls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .inputField {
        flex: 1;
        min-width: 200px;
        padding: 14px 18px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 15px;
      }

      .inputField:focus {
        outline: none;
        border-color: #667eea;
      }

      .uploadBtn, .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 10px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .uploadBtn {
        background: #667eea;
        color: white;
      }

      .btn {
        background: #764ba2;
        color: white;
      }

      .uploadBtn:hover, .btn:hover {
        transform: translateY(-2px);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
    </style>
    <title>PDF Q&A Chatbot</title>
  </head>
  <body>
    <section class="mainSec">
      <h1>üìÑ PDF Q&A Chatbot</h1>
      <div id="statusArea"></div>
      <div class="display" id="displayArea">Upload a PDF file to get started...</div>
      <div class="inputControls">
        <input type="text" class="inputField" id="questionInput" placeholder="Ask a question..." />
        <label for="fileToUpload" class="uploadBtn">Upload PDF</label>
        <input type="file" id="fileToUpload" accept=".pdf" hidden />
        <button class="btn" id="askBtn">Ask AI</button>
      </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script>
      const API_KEY = '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';

      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

      let extractedText = '';
      const fileInput = document.getElementById('fileToUpload');
      const displayArea = document.getElementById('displayArea');
      const statusArea = document.getElementById('statusArea');
      const questionInput = document.getElementById('questionInput');
      const askBtn = document.getElementById('askBtn');

      function showStatus(message, type = 'info') {
        statusArea.innerHTML = `<div class="status ${type}">${message}</div>`;
        if (type !== 'loading') {
          setTimeout(() => statusArea.innerHTML = '', 4000);
        }
      }

      async function extractTextFromPDF(file) {
        try {
          showStatus('Processing PDF...', 'loading');
          
          const arrayBuffer = await file.arrayBuffer();
          const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
          
          let fullText = '';
          const maxPages = Math.min(pdf.numPages, 10);
          
          for (let pageNum = 1; pageNum <= maxPages; pageNum++) {
            const page = await pdf.getPage(pageNum);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n\n';
          }
          
          extractedText = fullText;
          const preview = fullText.substring(0, 500) + '...';
          displayArea.innerHTML = `<strong style="color: #28a745;">‚úÖ PDF Loaded!</strong><br><br>${preview}`;
          showStatus(`Successfully loaded ${maxPages} pages!`, 'success');
          
        } catch (error) {
          showStatus('Error loading PDF: ' + error.message, 'error');
          displayArea.textContent = 'Error loading PDF.';
        }
      }

async function askQuestion(question) {
  const API_KEY = 'AIzaSyADCmvlg0OhkfHxG9f6hKYge7GV_Y0gDtk'; 
  
  if (!API_KEY || API_KEY === 'your-gemini-api-key-here') {
    displayArea.innerHTML = '<strong style="color: #dc3545;">‚ö†Ô∏è Add your API key on line 92</strong>';
    showStatus('API key not configured', 'error');
    return;
  }

  try {
    showStatus('AI is thinking...', 'loading');
    askBtn.disabled = true;
    
    const maxChars = 10000;
    const truncatedText = extractedText.substring(0, maxChars);
    
    const prompt = `You are answering questions based only on this document. If the answer is not in the document, say "I cannot find this information in the document."

Document:
${truncatedText}

Question: ${question}

Answer:`;
    
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        contents: [{
          parts: [{
            text: prompt
          }]
        }]
      })
    });

    console.log('Response status:', response.status);
    
    if (!response.ok) {
      const errorText = await response.text();
      console.error('Error response:', errorText);
      throw new Error(`API error ${response.status}: ${errorText}`);
    }

    const data = await response.json();
    console.log('Success! Full response:', data);
    
    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
      const answer = data.candidates[0].content.parts[0].text;
      displayArea.innerHTML = `<strong style="color: #667eea;">ü§ñ Answer:</strong><br><br>${answer}`;
      showStatus('Answer received!', 'success');
    } else {
      throw new Error('Unexpected response format');
    }
    
  } catch (error) {
    console.error('Full error:', error);
    displayArea.innerHTML = `<strong style="color: #dc3545;">Error:</strong><br><br>${error.message}<br><br>Check console (F12) for details.`;
    showStatus('Error occurred', 'error');
  } finally {
    askBtn.disabled = false;
  }
}

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file && file.type === 'application/pdf') {
          extractTextFromPDF(file);
        } else {
          showStatus('Please select a valid PDF', 'error');
        }
      });

      askBtn.addEventListener('click', () => {
        const question = questionInput.value.trim();
        if (!question) {
          showStatus('Please enter a question', 'error');
          return;
        }
        if (!extractedText) {
          showStatus('Please upload a PDF first', 'error');
          return;
        }
        askQuestion(question);
      });

      questionInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') askBtn.click();
      });
    </script>
  </body>
</html>